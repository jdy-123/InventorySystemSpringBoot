<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Stock Issuance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add Font Awesome for the icon -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Link to the external CSS file -->
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">Inventory System</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="transactionDropdown" data-bs-toggle="dropdown">Transaction</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="stockIssuance">Stock Issuance</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="reportDropdown" data-bs-toggle="dropdown">Report</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Inventory Records</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="maintenanceDropdown" data-bs-toggle="dropdown">Maintenance</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#">Product Maintenance</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="confirmLogout()">Logout</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="sidebar">
    <!-- Sidebar Toggle Icon -->
    <button class="toggle-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>

    <label for="shopSelect">SELECT SHOP</label>
    <select id="shopSelect" class="form-select">
        <option>ALL</option>
    </select>

    <label>FILTER BY DATE</label>
    <input type="date" class="form-control">
    <input type="date" class="form-control">
    <button class="btn btn-primary">FILTER</button>
    <button class="btn btn-secondary">IMPORT EXCEL</button>
    <button class="btn btn-success">INSERT DATA</button>
    <button class="btn btn-danger disabled-btn" disabled>VALIDATE</button>
</div>

<div class="content">
    <h1>Stock Issuance</h1>
    <div class="table-container">
        <table class="table table-striped table-bordered table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>PRODUCT CODE</th>
                <th>PRODUCT NAME</th>
                <th>DATE</th>
                <th>UNIT OF MEASUREMENT</th>
                <th>QUANTITY</th>
                <th>ADJUSTMENT</th>
                <th>GROSS AMOUNT</th>
                <th>TOTAL COST IN GROSS</th>
                <th>SHOP</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="stockIssuance: ${stockIssuance}">
                <td th:text="${stockIssuance.id}"></td>
                <td>
                    <input list="productCodeList" class="form-control productCode" id="productCode" th:value="${stockIssuance.productCode}" disabled /><datalist id="productCodeList">
                    <option th:if="${#lists.isEmpty(products)}" disabled>No products available</option>
                    <option th:each="product : ${products}" th:value="${product.productCode}" th:text="${product.productCode}"></option>
                </datalist>
                </td>
                <td>
                    <input list="productNameList" class="form-control productName" id="productName" th:value="${stockIssuance.productName}" disabled />
                    <datalist id="productNameList">
                        <option th:if="${#lists.isEmpty(products)}" disabled>No products available</option>
                        <option th:each="product : ${products}" th:value="${product.productName}" th:text="${product.productName}"></option>
                    </datalist>
                </td>
                <td th:text="${stockIssuance.date}"></td>
                <td>
                    <span th:each="product : ${products}" th:if="${product.productCode == stockIssuance.productCode}" th:text="${product.unitOfMeasurement}"></span>
                </td>
                <td>
                    <input type="number" class="quantity" id="quantity" th:value="${stockIssuance.quantity}" disabled />
                </td>
                <td>
                    <input type="number" class="adjustment" id="adjustment" th:value="${stockIssuance.adjustment}" disabled />
                </td>
                <td th:text="${#numbers.formatDecimal(stockIssuance.grossAmount, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(stockIssuance.totalCostInGross, 1, 'COMMA', 2, 'POINT')}"></td>

                <td>
                    <input list="shopList" class="form-control shop" id="shop" th:value="${stockIssuance.shop}" disabled />
                    <datalist id="shopList">
                        <option th:each="shop : ${shops}" th:value="${shop}" th:text="${shop}"></option>
                    </datalist>
                </td>
                <td class="d-flex justify-content-start gap-2">
                    <button type="button" class="btn btn-warning" onclick="editRow(this)">Edit</button>
                    <form method="post" th:action="@{/stockIssuance/delete}" onsubmit="return confirm('Are you sure you want to delete?')">
                        <input type="hidden" th:name="id" th:value="${stockIssuance.id}" />
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </td>
            </tr>  <!-- New row for adding data -->
            <tr id="newRow">
                <td></td>
                <td>
                    <input list="productCodeList" class="form-control productCode" id="newProductCode" />
                </td>
                <td>
                    <input list="productNameList" class="form-control productName" id="newProductName" />
                </td>
                <td>
                    <input type="text" class="form-control date" id="newDate" readonly />
                </td>
                <td>
                    <input type="text" class="form-control unitOfMeasurement" id="newUnitOfMeasurement" readonly/>
                </td>
                <td>
                    <input type="number" class="form-control quantity" id="newQuantity" />
                </td>
                <td>
                    <input type="number" class="form-control adjustment" id="newAdjustment" />
                </td>
                <td>
                    <input type="number" class="form-control grossAmount" id="newGrossAmount" readonly />
                </td>
                <td>
                    <input type="number" class="form-control totalCostInGross" id="newTotalCostInGross" readonly />
                </td>
                <td>
                    <input list="shopList" class="form-control shop" id="newShop" />
                </td>
                <td class="d-flex justify-content-start gap-2">
                    <button type="button" class="btn btn-success" onclick="saveNewRow()">Save</button>
                </td>
            </tr>

            </tbody>

        </table>
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
                <li class="page-item" th:classappend="${stockIssuance != null and stockIssuance.hasPrevious()} ? '' : 'disabled'">
                    <a class="page-link" th:href="@{|/stockIssuance?page=0|}">First</a>
                </li>
                <li class="page-item" th:classappend="${stockIssuance != null and stockIssuance.hasPrevious()} ? '' : 'disabled'">
                    <a class="page-link" th:href="@{|/stockIssuance?page=${stockIssuance.number - 1}|}">Previous</a>
                </li>
                <li class="page-item" th:classappend="${stockIssuance != null and stockIssuance.hasNext()} ? '' : 'disabled'">
                    <a class="page-link" th:href="@{|/stockIssuance?page=${stockIssuance.number + 1}|}">Next</a>
                </li>
                <li class="page-item" th:classappend="${stockIssuance != null and stockIssuance.hasNext()} ? '' : 'disabled'">
                    <a class="page-link" th:href="@{|/stockIssuance?page=${stockIssuance.totalPages - 1}|}">Last</a>
                </li>
            </ul>
        </nav>


    </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function confirmLogout() {
        if (confirm("Are you sure you want to logout?")) {
            window.location.href = "/login";
        }
    }

    function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        const content = document.querySelector('.content');
        sidebar.classList.toggle('hidden');
        content.classList.toggle('expanded');

        if (sidebar.classList.contains('hidden')) {
            content.style.marginLeft = '50px'; // Expand content area when sidebar is hidden
            content.style.width = '100%';
        } else {
            content.style.marginLeft = '250px'; // Reset content margin when sidebar is visible
            content.style.width = 'calc(100% - 250px)';
        }
    }

    function editRow(button) {
        const row = button.closest('tr');
        const productCode = row.querySelector('.productCode');
        const productName = row.querySelector('.productName');
        const shop = row.querySelector('.shop');
        const quantity = row.querySelector('.quantity');
        const adjustment = row.querySelector('.adjustment');

        // Toggle disabled state
        productCode.disabled = !productCode.disabled;
        productName.disabled = !productName.disabled;
        shop.disabled = !shop.disabled;
        quantity.disabled = !quantity.disabled;
        adjustment.disabled = !adjustment.disabled;

        // Change button text
        button.innerText = button.innerText === "Edit" ? "Save" : "Edit";
    }

    function saveNewRow() {
        const newRow = document.getElementById('newRow');

        // Get input values
        const productCode = document.getElementById('newProductCode').value;
        const productName = document.getElementById('newProductName').value;
        const date = document.getElementById('newDate').value;
        const unitOfMeasurement = document.getElementById('newUnitOfMeasurement').value;
        const quantity = document.getElementById('newQuantity').value;
        const adjustment = document.getElementById('newAdjustment').value;
        const grossAmount = document.getElementById('newGrossAmount').value;
        const totalCostInGross = document.getElementById('newTotalCostInGross').value;
        const shop = document.getElementById('newShop').value;

       /* if (!productCode || !productName || !date || !quantity || !shop) {
            alert("Please fill out all required fields.");
            return;
        } */

        // Create a form and submit via POST request
        const form = document.createElement("form");
        form.method = "post";
        form.action = "/stockIssuance/save";

        form.innerHTML = `
            <input type="hidden" name="productCode" value="${productCode}">
            <input type="hidden" name="productName" value="${productName}">
            <input type="hidden" name="date" value="${date}">
            <input type="hidden" name="unitOfMeasurement" value="${unitOfMeasurement}">
            <input type="hidden" name="quantity" value="${quantity}">
            <input type="hidden" name="adjustment" value="${adjustment}">
            <input type="hidden" name="grossAmount" value="${grossAmount}">
            <input type="hidden" name="totalCostInGross" value="${totalCostInGross}">
            <input type="hidden" name="shop" value="${shop}">
        `;

        document.body.appendChild(form);
        form.submit();
    }

    function deleteNewRow() {
        document.getElementById('newProductCode').value = "";
        document.getElementById('newProductName').value = "";
        document.getElementById('newDate').value = "";
        document.getElementById('newUnitOfMeasurement').value = "";
        document.getElementById('newQuantity').value = "";
        document.getElementById('newAdjustment').value = "";
        document.getElementById('newGrossAmount').value = "";
        document.getElementById('newTotalCostInGross').value = "";
        document.getElementById('newShop').value = "";
    }

    document.addEventListener("DOMContentLoaded", function() {
        const today = new Date();
        document.getElementById("newDate").value = today.getFullYear() + '-' +
            String(today.getMonth() + 1).padStart(2, '0') + '-' +
            String(today.getDate()).padStart(2, '0');
    });

</script>
</body>
</html>
